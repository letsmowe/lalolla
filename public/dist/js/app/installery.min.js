/*!
 * Mowe Installery v1.0.0 (http://letsmowe.com/)
 * Copyright 2013-2016 Kabana's Info Developers
 * Licensed under MIT (https://github.com/noibe/villa/blob/master/LICENSE)
 */
var Installery=function(){function t(t,a){var i=this;this.viewport=t,this.view={},this.view.data=[],this.view.lastInstagram_id=0,this.view.lastBrand_id=0,this.view.options={},this.view.options.hashtag=!1,this.view.options.instagramPerView=6,this.view.options.brandPerView=2,this.view.options.query=[],this.instagram={},this.instagram.data=[],this.instagram.allData=!1,this.instagram.lastInstagram_id=0,this.brand={},this.brand.data=[],this.brand.lastBrands_id=0,this.autoload=!1,this.loadLast=0,this.ajaxCtrl=function(t){console.log(t),i.updateInstagramData(t)}}return t.prototype.isOnArray=function(t,a,i){for(var s=t.length;s--;){if(t[s]==a)return!0;if(i&&!(t[s]-i>a||t[s]+i<a))return!0}return!1},t.prototype.getNumbers=function(t,a,i,s){for(var r=[];r.length!=t;){var n=Math.floor(Math.random()*(i-a))+a;this.isOnArray(r,n,s)||r.push(n)}return r},t.prototype.hasTag=function(t,a){return this.isOnArray(t.tags,a,!1)},t.prototype.doTagQuery=function(t){for(var a=this.view.options.query.length;a--;)if(this.hasTag(t,this.view.options.query[a]))return!0;return!1},t.prototype.getBrandMedia=function(t){var a,i;a=[],i=this.getNumbers(t,0,3,!1);for(var s=t;s--;)a.push(this.brand.data[i[s]]);return a},t.prototype.getInstagramMedia=function(t){var a,i,s,r;for(a=[],i=this.view.lastInstagram_id+t,s=!1;this.view.lastInstagram_id<i&&!s;)(r=this.instagram.data[this.view.lastInstagram_id])?this.view.options.query.length?(this.doTagQuery(r)&&a.push(r),this.view.lastInstagram_id++):(a.push(r),this.view.lastInstagram_id++):s=!s;return a},t.prototype.mergeMedia=function(t,a,i){var s,r,n,e;s=[],n=this.getNumbers(this.view.options.brandPerView,1,i,2),r=0,e=0;for(var o=0;i>o;o++)o&&this.isOnArray(n,o,!1)?s.push(t[r++]):s.push(a[e++]);return s},t.prototype.loadMedia=function(t,a){var i,s,r;return s=this.getInstagramMedia(t),i=this.getBrandMedia(a),r=this.mergeMedia(i,s,s.length+i.length)},t.prototype.buildMediaItem=function(t){var a=document.createElement("article");return a.classList.add("InstalleryMedia"),t.brand?a.classList.add("InstalleryMedia--brand"):a.classList.add("InstalleryMedia--instagram"),a.style.backgroundImage='url("'+t.images.standard_resolution.url+'")',a},t.prototype.buildView=function(t){for(var a=[],i=0;i<t.length;i++)t[i]&&(t[i].viewport||(t[i].viewport=this.buildMediaItem(t[i])),a.push(t[i]));return a},t.prototype.loadView=function(){for(var t=this.loadMedia(this.view.options.instagramPerView,this.view.options.brandPerView),a=this.buildView(t),i=0;i<a.length;i++)this.viewport.appendChild(a[i].viewport.cloneNode(!0))},t.prototype.initMedia=function(){this.loadView(),this.view.options.instagramPerView=7,this.view.options.brandPerView=1},t.prototype.loadBrandData=function(t){for(var a=0;a<t.length;a++)t[a].brands_id=this.brand.lastBrands_id,this.brand.data.push(t[a]),this.brand.lastBrands_id=t[a].brands_id,this.brand.lastBrands_id++},t.prototype.updateInstagramMediaItem=function(t){t.instagram_id=this.instagram.lastInstagram_id++,this.instagram.data.push(t)},t.prototype.updateInstagramData=function(t){this.instagram.meta=t.meta,this.instagram.pagination=t.pagination,console.log(t);for(var a=0;a<t.data.length;a++)this.updateInstagramMediaItem(t.data[a]);this.instagram.loadAll&&(this.instagram.pagination.next_url?this.loadInstagramData(this.instagram.pagination.next_url,this):this.instagram.loadAll=!1),this.loadLast++||this.initMedia(),this.autoload&&(this.autoload=!1,this.initMedia())},t.prototype.loadInstagramData=function(t,a){$.ajax({type:"get",dataType:"jsonp",url:t,cache:!1,success:a.ajaxCtrl,error:function(){console.log("ajax error")}})},t.prototype.firstBiteInstagramData=function(t){$.ajax({type:"get",dataType:"jsonp",url:t,cache:!1,success:this.ajaxCtrl,error:function(){console.log("ajax error")}})},t.prototype.loadMore=function(){console.log("kkk"),this.instagram.loadAll||(this.instagram.loadAll=!0),this.instagram.pagination.next_url&&this.loadInstagramData(this.instagram.pagination.next_url,this),this.loadView()},t.prototype.destroyView=function(){this.viewport.innerHTML="",this.view.data=[],this.view.lastInstagram_id=0},t.prototype.reload=function(){this.destroyView(),this.view.options.query=["camisetas"],this.autoload=!0,this.loadView()},t.prototype.init=function(t){this.firstBiteInstagramData(t)},t}();